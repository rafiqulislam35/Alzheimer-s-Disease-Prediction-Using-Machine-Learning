<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin • Users</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --green:#16a34a; 
    --bg:#f3f4f6; 
    --card:#fff; 
    --border:#e5e7eb;
    --text:#111827; 
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{margin:0;
    font-family:system-ui,
    -apple-system,"Segoe UI",sans-serif;
    background:var(--bg);
    color:var(--text)
  }

  .topbar{
    background:var(--green);color:#fff;padding:10px 18px;
    display:flex;justify-content:space-between;align-items:center
  }
  .pill{background:rgba(0,0,0,.12);border:1px solid rgba(0,0,0,.15);padding:6px 10px;border-radius:999px}
  .pill a{color:#fff;text-decoration:underline}

  .wrap{max-width:1200px;margin:18px auto;padding:0 14px;width:100%}
  .header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:14px 0;flex-wrap:wrap}
  .btn{background:#fff;border:1px solid var(--border);padding:8px 12px;border-radius:10px;text-decoration:none;color:var(--text);font-size:.9rem}

  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}

  /* ✅ flexible table container */
  .table-wrap{
    width:100%;
    overflow-x:auto;              /* only if needed */
    -webkit-overflow-scrolling:touch;
    border-radius:10px;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:.92rem;
    min-width: 980px;             /* prevents squished columns on small screens */
  }

  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:middle}
  th{font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.04em;background:#fafafa;position:sticky;top:0}
  tr:hover td{background:#fcfcfd}
  tr:last-child td{border-bottom:none}

  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

  .badge{padding:2px 8px;border-radius:999px;font-size:.75rem;border:1px solid var(--border);background:#f9fafb}

  .status-pill{padding:2px 10px;border-radius:999px;font-size:.75rem;border:1px solid var(--border)}
  .status-active{background:#dcfce7;color:#166534;border-color:#bbf7d0}
  .status-disabled{background:#fee2e2;color:#991b1b;border-color:#fecaca}

  /* ✅ professional action buttons */
.actions{
  text-align:right;
  white-space:nowrap;
}
form.inline{display:inline;margin:0}

.btn-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#fff;
  color:var(--text);
  font-size:.85rem;
  cursor:pointer;
  text-decoration:none;
  margin-left:6px;
}
.btn-link:hover{filter:brightness(.98)}

.btn-primary{border-color:#c7d2fe;background:#eef2ff;color:#1d4ed8}
.btn-warn{border-color:#fed7aa;background:#fff7ed;color:#9a3412}
.btn-danger{border-color:#fecaca;background:#fef2f2;color:#b91c1c}

</style>

</head>
<body>
<div class="topbar">
  <div style="display:flex;align-items:center;gap:12px;">
    
    <!-- ADMIN DASHBOARD BUTTON -->
    <div class="sidebar-logo">
      <a href="/admin"
         title="Admin dashboard"
         style="color:#fff;text-decoration:none;
                display:flex;align-items:center;justify-content:center;
                width:32px;height:32px;
                border-radius:8px;
                background:rgba(0,0,0,.25);
                font-weight:700;">
        A
      </a>
    </div>

    <div><b>Admin console</b> • Users</div>
  </div>

  <div class="pill">
    {{ full_name or user_email or "Admin" }}
    &nbsp;
    <a href="/logout" style="color:#fff;text-decoration:underline;">Logout</a>
  </div>
</div>


  <div class="wrap">
    <div class="header">
      <div>
        <h2 style="margin:0;">All users</h2>
        <div class="muted" style="margin-top:4px;">
          Full list of registered accounts, including activity & controls.
        </div>
      </div>
      <a class="btn" href="/admin">← Back to admin dashboard</a>
    </div>

    <div class="card">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Full name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Role</th>
              <th>Status</th>
              <th>Joined</th>
              <th>Days using</th>
              <th>Patients</th>
              <th>Predictions</th>
              <th>Last activity</th>
              <th style="text-align:right;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.full_name or "-" }}</td>
              <td class="mono">{{ u.email or "-" }}</td>
              <td class="mono">{{ u.phone or "-" }}</td>

              <td><span class="badge">{{ u.role or "user" }}</span></td>

              <td>
                {% if (u.status or "active") == "disabled" %}
                  <span class="status-pill status-disabled">disabled</span>
                {% else %}
                  <span class="status-pill status-active">active</span>
                {% endif %}
              </td>

              <td class="mono">
                {% if u.created_at %}
                  {{ u.created_at.strftime("%Y-%m-%d") }}
                {% else %}
                  -
                {% endif %}
              </td>

              <td>{{ u.days_using if u.days_using is not none else 0 }}</td>
              <td>{{ u.patients_count if u.patients_count is not none else 0 }}</td>
              <td>{{ u.predictions_count if u.predictions_count is not none else 0 }}</td>

              <td class="mono">
                {% if u.last_activity %}
                  {{ u.last_activity.strftime("%Y-%m-%d %H:%M") }}
                {% else %}
                  -
                {% endif %}
              </td>

              <td class="actions">
                <!-- EDIT -->
                <a class="btn-link btn-primary" href="/admin/users/{{ u.id }}/edit">Edit</a>

                <!-- DISABLE / ENABLE -->
                {% set confirm_text = "Enable this user?" if u.status == "disabled"
                  else "Disable this user? They will not be able to login." %}

                <form class="inline"
                      method="post"
                      action="/admin/users/{{ u.id }}/toggle"
                      onsubmit="return confirm('{{ confirm_text }}');">
                  <button
                    class="btn-link {{ 'btn-warn' if u.status != 'disabled' else 'btn-primary' }}"
                    type="submit"
                  >
                    {{ "Enable" if u.status == "disabled" else "Disable" }}
                  </button>
                </form>

                <!-- DELETE -->
                <form class="inline"
                      method="post"
                      action="/admin/users/{{ u.id }}/delete"
                      onsubmit="return confirm('Delete this user permanently? This will remove all related data.');">
                  <button class="btn-link btn-danger" type="submit">Delete</button>
                </form>
              </td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if not users or users|length == 0 %}
        <div class="muted" style="padding:10px 2px;">No users found.</div>
      {% endif %}
    </div>
  </div>
</body>
</html>
